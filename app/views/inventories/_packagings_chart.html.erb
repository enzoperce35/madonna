<div class="container">
  <%= link_to 'Add Packaging', new_packaging_path, {:class => "btn btn-outline-secondary btn-sm"} %><br><br>
  <% @packagings.each_with_index do | i, index | %>
    <% raw_data = (i.remaining_stock / i.current_stock) * 100.round(2) %>
    <% data = raw_data.to_s + '%' %>
    <% index += @ingredients.length + 1 %>
    <% index = index.to_s %>
    <% id_target = 'prog-' + index.to_s %>
      
    <% if raw_data > 50 %>
      <% bg = 'bg-success' %>
    <% elsif raw_data <= 25 %>
      <% bg = 'bg-danger' %>
    <% else %>
      <% bg = 'bg-warning' %>
    <% end %>
    
    <div class="container" style="padding-left: 0%;">
      <div>
        <strong><%= link_to i.name, packaging_path(i), method: 'get' %></strong>
      </div>
      <div class="progress">
        <div id=<%= id_target %> class="progress-bar <%= bg %>" role="progressbar" aria-valuenow="41" aria-valuemin="0" aria-valuemax="100"><%= raw_data.round(2).to_s %>%</div>
      </div>
    </div>

    <style>
      :root {
      --data: <%= data %>;
      --index: <%= index %>;
      --pack_count: <%= @packagings.length %>;
      }
    </style>

    <script>
      var css_root = document.querySelector(':root');
      var css_data = getComputedStyle(css_root);
        
      var data = css_data.getPropertyValue('--data');
      var index = css_data.getPropertyValue('--index');
      var pack_count = css_data.getPropertyValue('--pack_count')

      num_in_js_format = Number(index)
        
      data_arr.push(data)
      id_arr.push(num_in_js_format)
        
      render_data(data_arr, id_arr); if (pack_count == num_in_js_format);
    </script> 
  <% end %>
</div>
  